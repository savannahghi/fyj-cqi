{% extends 'dqa/index_dqa.html' %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}
{% load static %}


{% block content %}
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class="p-5 mb-4 bg-light rounded-3">

            {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                        <div class="alert alert-info col-12" role="alert">
                            <h5 class="d-flex justify-content-evenly">{{ message }}</h5>
                        </div>
                        {#            <li{% if message.0.tags %} class="{{ message.0.tags }}"{% endif %}>{{ message }}</li>#}
                    {% endfor %}
                </ul>
            {% endif %}

            <div class="container-fluid py-5">
                <h1 class="display-6 fw-bold text-primary">{{ title }} </h1>

                {#          {% endfor %}#}
                {% if qi_project %}
                    <h4 class="display-6">FACILITY: {{ qi_project.facility_name }}</h4>
                    <h6 class="mb-4 mt-4">CQI PROJECT: {{ qi_project.project_title|upper }}</h6>
                    <div class="row mb-4">
                        {#              <div class="col d-flex justify-content-between">#}
                        <div class="col-md-6">
                            <strong>OBJECTIVE: </strong>{{ qi_project.objective|safe  }}
                        </div>
                        <div class="col-md-6">
                            <strong>SUB-COUNTY: </strong>{{ qi_project.sub_county }}
                        </div>
                        <div class="col-md-6">
                            <strong>NUMERATOR: </strong> {{ qi_project.numerator }}
                        </div>
                        <div class="col-md-6">
                            <strong>DENOMINATOR: </strong>{{ qi_project.denominator }}
                        </div>
                        {#              </div>#}
                    </div>
                {% endif %}
                {% if lesson_learnt %}
                    <div class="row mb-4">
                        {#              <div class="col d-flex justify-content-between">#}

                        <div class="col-md-12 text-primary">
                            {% for lesson in lesson_learnt %}
                                <strong>FUTURE PLANS: </strong>{{ lesson.future_plans }}

                            {% endfor %}


                        </div>
                    </div>

                {% endif %}


                {% if "ADD RESOURCES" in title %}

                    <form class="row " method="POST" class="mt-5" enctype='multipart/form-data' autocomplete="off">
                        {% csrf_token %}
                        {% for field in form %}
                            {% if "description" in field.html_name or "name" in field.html_name|lower %}
                                <div class="col-md-12 mt-4">
                                    {{ field|as_crispy_field }}
                                </div>
                            {% else %}
                                <div class="col-md-6 mt-4">
                                    {{ field|as_crispy_field }}
                                </div>
                            {% endif %}
                        {% endfor %}
                        <div class="col-md-4 mt-3">
                            <input class="btn btn-success mt-1" type="submit" value="Submit">
                        </div>
                        {% if form.errors %}
                            <div class="alert alert-danger mt-4">
                                {{ form.errors }}
                            </div>
                        {% endif %}
                    </form>

                {% elif "test of change" in title %}
                    <form class="row" method="POST" class="mt-5" enctype='multipart/form-data' autocomplete="off">
                        {% csrf_token %}
                        {% for field in form %}
                            {% if "comment" in field.html_name or "tested" in field.html_name|lower %}
                                <div class="col-md-12 mt-4">
                                    {{ field|as_crispy_field }}
                                </div>
                            {% else %}
                                <div class="col-md-6 mt-4">
                                    {{ field|as_crispy_field }}
                                </div>
                            {% endif %}
                        {% endfor %}
                        <div class="col-md-4 mt-3">
                            <input class="btn btn-success mt-1" type="submit" value="Submit">
                        </div>
                        {% if form.errors %}
                            <div class="alert alert-danger mt-4">
                                {{ form.errors }}
                            </div>
                        {% endif %}
                    </form>

                {% elif "Action Plan" in title %}
                    <form class="row mt-5" method="POST" enctype='multipart/form-data' autocomplete="off">
                        {% csrf_token %}
                        {% for field in form %}
                            {% if "comment" in field.html_name or "tested" in field.html_name|lower %}
                                <div class="col-md-12 mt-4">
                                    {{ field|as_crispy_field }}
                                </div>
                            {% else %}
                                <div class="col-md-6 mt-4">
                                    {{ field|as_crispy_field }}
                                </div>
                            {% endif %}
                        {% endfor %}
                        <div class="col-md-12 mt-3">
                            <input class="btn btn-success mt-1" type="submit" value="Submit">
                        </div>
                        {% if form.errors %}
                            <div class="alert alert-danger mt-4">
                                {{ form.errors }}
                            </div>
                        {% endif %}
                    </form>

                {% elif "DQA Work Plan" in title %}
                    <h6 class="mb-4 mt-4">FACILITY: {{ facility }}</h6>
                    <h6 class="mb-4 mt-4">MFL CODE: {{ mfl_code }}</h6>
                    <h6 class="mb-4 mt-4">DQA date: {{ date_modified }}</h6>
                    <h6 class="mb-4 mt-4">Quarter-FY: {{ quarter_year }}</h6>
                    {% if system_assessment_no or system_assessment_partly %}
                        <p class="text-primary small">Ensuring the accuracy, reliability, completeness, timeliness, and
                            consistency of the data that Fahari ya Jamii (FYJ) collected is crucial. To achieve this, we
                            recommend adopting a proactive approach that involves ongoing data quality assessment (DQA)
                            and implementing continuous quality improvement (CQI) processes.
                        </p>
                        <p class="text-primary small">
                            CQI helps address the root causes of data quality issues identified through DQA, which
                            prompts us to create action plans for all system assessment areas that score <strong
                                class="text-warning">Yellow</strong> or <strong class="text-danger">Red</strong>.
                            Through CQI, we remain focused on our goals, maintain accountability, and continuously
                            improve the quality of care we provide to our patients.
                        </p>
                        <p class="text-primary small">
                            By adopting ongoing DQA and CQI, we ensure that our data is accurate and reliable,
                            supporting better decision-making, program planning, and overall performance. It also
                            ensures we meet reporting and accountability requirements for external funding sources.

                        </p>
                        <div class="row">
                            {% if system_assessment_partly %}
                                <div class="col-md-4">
                                    <div>
                                        <a class="btn btn-warning" data-bs-toggle="collapse" href="#collapseyellows"
                                           role="button" aria-expanded="false" aria-controls="collapseyellows">
                                            System assessment YELLOW scores
                                            <span class="badge bg-secondary" data-bs-toggle="tooltip"
                                                  title="Number of YELLOW scores. Click to view">{{ system_assessment_partly.count }}</span>
                                        </a>
                                    </div>
                                </div>
                            {% endif %}
                            {% if system_assessment_no %}
                                <div class="col-md-4">
                                    <div>
                                        <a class="btn btn-danger" data-bs-toggle="collapse" href="#collapsereds"
                                           role="button" aria-expanded="false" aria-controls="collapsereds">
                                            System assessment RED scores
                                            <span class="badge bg-secondary" data-bs-toggle="tooltip"
                                                  title="Number of RED scores. Click to view">{{ system_assessment_no.count }}</span>
                                        </a>
                                    </div>
                                </div>
                            {% endif %}
                            {% if data_verification and khis_performance and fyj_performance %}
                                <div class="col-md-4">
                                    <div>
                                        <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapsedataverification"
                                           role="button" aria-expanded="false" aria-controls="collapsedataverification">
                                            Data Verification
                                        </a>
                                    </div>
                                </div>
                            {% endif %}
                            <div class="collapse bg-light mt-2" id="collapseyellows">
                                {% if system_assessment_partly %}
                                    <table class="table table-striped table-hover">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th>Description</th>
                                            <th>Auditors Note</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for system_assessment in system_assessment_partly %}
                                            <tr>
                                                <td class="text-warning fw-bold">{{ forloop.counter }}.</td>
                                                <td>{{ system_assessment.description }}</td>
                                                <td class="text-warning">{{ system_assessment.auditor_note }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="collapse bg-light mt-2" id="collapsereds">
                                {% if system_assessment_no %}
                                    <table class="table table-striped table-hover">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th> Description</th>
                                            <th> Auditors Note</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for system_assessment in system_assessment_no %}
                                            <tr>
                                                <td class="text-danger fw-bold">{{ forloop.counter }}.</td>
                                                <td> {{ system_assessment.description }} </td>
                                                <td class="text-danger">{{ system_assessment.auditor_note }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                            </div>
                        </div>
                        </div>
                    {% endif %}
                    {#                    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">#}
                    <div class="row">
                        <div class="collapse bg-light mt-2" id="collapsedataverification">
                            {% if data_verification and khis_performance and fyj_performance %}
                                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                                    <div class="col-md-12">
                                        <h6 class="display-6 text-primary text-center">HIV DQA Facility Data
                                            Verification
                                            Assessment Tool</h6>
                                        <hr>
                                        {% if data_verification %}
                                            <div class="d-flex justify-content-start">
                                                <h6 class="h6">Program Area Assessed (<span
                                                        style="color: blue;">{{ program_accessed|length }}</span>):
                                                </h6>
                                                {% for program in program_accessed %}
                                                    <p style="font-size: small; margin-left: 5px;">{{ program }}, </p>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <table class="table table-striped table-hover" style="font-size: small;">
                                    <thead class="thead-dark">
                                    <tr>
                                        <th></th>
                                        <th colspan="3" style="font-size: x-small"> Primary Data source
                                            (Registers/EMR)
                                        </th>
                                        <th></th>
                                        <th colspan="3" style="font-size: x-small"> Verification MOH 731</th>
                                        <th></th>
                                        <th colspan="3" style="font-size: x-small"> Verification KHIS</th>
                                        <th></th>
                                        <th colspan="3" style="font-size: x-small"> Verification DATIM/DHIS2</th>
                                    </tr>
                                    <tr>
                                        <th></th>
                                        <th colspan="3" style="font-size: x-small"> VALUE COUNTED FROM SOURCE</th>
                                        <th></th>
                                        <th colspan="3" style="font-size: x-small"> VALUE REPORTED (MOH 731)</th>
                                        <th></th>
                                        <th colspan="3" style="font-size: x-small"> NUMBER IN KHIS</th>
                                        <th></th>
                                        <th colspan="3" style="font-size: x-small"> VALUE REPORTED (DATIM/DHIS2)</th>
                                    </tr>
                                    {% if quarters %}
                                        <tr>
                                            <th style="font-size: x-small">Indicator</th>
                                            {% for key,months in quarters.items %}
                                                {% for month in months %}
                                                    <th style="font-size: x-small">{{ month }}</th>
                                                {% endfor %}
                                                {% for month in months %}
                                                    <th style="font-size: x-small">{{ month }}</th>
                                                {% endfor %}
                                                {% for month in months %}
                                                    <th style="font-size: x-small">{{ month }}</th>
                                                {% endfor %}
                                                <th class="align-middle text-center" style="font-size: x-small ">
                                                    FY {{ selected_year }} {{ key }}</th>
                                                {% for data in data_verification %}
                                                    {% if forloop.last %}
                                                        {% if not data.hide_update_button or request.user.is_superuser %}
                                                            <th></th>
                                                        {% endif %}
                                                    {% endif %}
                                                {% endfor %}
                                            {% endfor %}
                                        </tr>
                                    {% endif %}
                                    </thead>
                                    <tbody>
                                    {% if data_verification and khis_performance and fyj_performance %}
                                        {% for data in data_verification %}
                                            <tr>
                                                <!-- INDICATORS -->
                                                {% if "_total" in data.indicator|lower or "positive (pmtct)" in data.indicator|lower or "haart total" in data.indicator|lower or "children currently on art" in data.indicator|lower or "children starting art" in data.indicator|lower or "infant prophylaxis" in data.indicator|lower %}
                                                    <td class="fw-bold"
                                                        style="background-color: #8fd19e; font-style: italic">{{ data.indicator }}</td>
                                                {% else %}
                                                    <td class="align-middle text-center">{{ data.indicator }}</td>
                                                {% endif %}
                                                <!-- REGISTERS RAW DATA-->
                                                <td class="align-middle text-center">{{ data.field_1 }}</td>
                                                <td class="align-middle text-center">{{ data.field_2 }}</td>
                                                <td class="align-middle text-center">{{ data.field_3 }}</td>
                                                <!-- REGISTERS TOTAL-->
                                                {% if "prep" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.prep_new_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "tpt" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.ipt_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "sex" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.gbv_sexual_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "emot" in data.indicator|lower %}
                                                    {#                <td class="align-middle text-center fw-bold">#}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "cancer" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.cx_ca_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "l test" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_t_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "aged <15 years" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_p_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "aged 15+ years" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_a_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "_total" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_a_total|add:total.tst_pos_p_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "n positive at 1st anc" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.kp_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "results_anc" in data.indicator|lower %}

                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_pos_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "on haart" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.on_haart_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "haart anc" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_on_haart_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "prophyl_anc" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "results_l&d" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "haart_l&d" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "prophyl_l&d" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "tx_ml" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.field_3 }}
                                                    </td>
                                                {% elif "rtt" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.field_3 }}
                                                    </td>
                                                {% elif "tb_prev" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "results_pnc<=6 weeks" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "haart_pnc<= 6 weeks" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "prophyl_pnc<= 6 weeks" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "positive (pmtct)" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.kp_anc_total|add:total.new_pos_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "haart total" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_on_haart_anc_total|add:total.on_haart_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "infant prophylaxis" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "under 15yrs starting" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_p_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "above 15yrs starting" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_a_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "children starting art" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_a_total|add:total.tx_new_p_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "relapse tb_cases" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tb_stat_d_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_source }}
                                                    </td>
                                                {% elif "art <15years" in data.indicator|lower %}
                                                    <!--COMPARE SOURCE, MOH 731 AND KHIS-->
                                                    {% for p in khis_performance %}
                                                        {% if forloop.last %}
                                                            {% with khis_tx_curr_p=p.tx_curr_p|floatformat %}
                                                                {% with source_tx_curr_p=data.field_3|floatformat %}
                                                                    {% with moh_731_tx_curr_p=data.field_7|floatformat %}
                                                                        <td class="align-middle text-center text-white fw-bold"
                                                                            style="background-color: {% if source_tx_curr_p == moh_731_tx_curr_p and moh_731_tx_curr_p ==  khis_tx_curr_p %}green{% else %}red{% endif %}">
                                                                            {{ source_tx_curr_p }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endwith %}
                                                        {% endif %}
                                                    {% endfor %}
                                                {% elif "art 15+ years" in data.indicator|lower %}
                                                    <!--COMPARE SOURCE, MOH 731 AND KHIS-->
                                                    {% for p in khis_performance %}
                                                        {% if forloop.last %}
                                                            {% with khis_tx_curr_a=p.tx_curr_a|floatformat %}
                                                                {% with source_tx_curr_a=data.field_3|floatformat %}
                                                                    {% with moh_731_tx_curr_a=data.field_7|floatformat %}
                                                                        <td class="align-middle text-center text-white fw-bold"
                                                                            style="background-color: {% if source_tx_curr_a == moh_731_tx_curr_a and moh_731_tx_curr_a ==  khis_tx_curr_a %}green{% else %}red{% endif %}">
                                                                            {{ source_tx_curr_a }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endwith %}
                                                        {% endif %}
                                                    {% endfor %}
                                                {% elif "children currently on art" in data.indicator|lower %}
                                                    <!--COMPARE SOURCE, MOH 731 AND KHIS-->
                                                    {% for p in khis_performance %}
                                                        {% if forloop.last %}
                                                            {% with khis_tx_curr=p.tx_curr_a|add:p.tx_curr_p|floatformat %}
                                                                {% with source_tx_curr_a=data.field_3|floatformat %}
                                                                    {% with moh_731_tx_curr_a=data.field_7|floatformat %}
                                                                        <td class="align-middle text-center text-white fw-bold"
                                                                            style="background-color: {% if source_tx_curr_a == moh_731_tx_curr_a and moh_731_tx_curr_a ==  khis_tx_curr %}green{% else %}red{% endif %}">
                                                                            {{ source_tx_curr_a }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endwith %}
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                                <!-- MOH 731 RAW DATA-->
                                                {% if "tx_ml" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>

                                                {% elif "tb_prev" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>

                                                {% elif "rtt" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>
                                                {% else %}
                                                    <td class="align-middle text-center">{{ data.field_5 }}</td>
                                                {% endif %}
                                                {% if "tx_ml" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>

                                                {% elif "tb_prev" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>

                                                {% elif "rtt" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>
                                                {% else %}
                                                    <td class="align-middle text-center">{{ data.field_6 }}</td>
                                                {% endif %}
                                                {% if "tx_ml" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>

                                                {% elif "tb_prev" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>

                                                {% elif "rtt" in data.indicator|lower %}
                                                    <td class="align-middle text-center">-</td>
                                                {% else %}
                                                    <td class="align-middle text-center">{{ data.field_7 }}</td>
                                                {% endif %}
                                                <!-- MOH 731 TOTALS-->
                                                {% if "prep" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.prep_new_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "tpt" in data.indicator|lower %}

                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.ipt_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "sex" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.gbv_sexual_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "emot" in data.indicator|lower %}
                                                    {#                <td class="align-middle text-center fw-bold">#}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "cancer" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.cx_ca_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "l test" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_t_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "aged <15 years" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_p_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "aged 15+ years" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_a_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "_total" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_a_total|add:total.tst_pos_p_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "n positive at 1st anc" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.kp_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "results_anc" in data.indicator|lower %}

                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_pos_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "on haart" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.on_haart_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "haart anc" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_on_haart_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "prophyl_anc" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "results_l&d" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "haart_l&d" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "prophyl_l&d" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "tx_ml" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        -
                                                    </td>
                                                {% elif "rtt" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        -
                                                    </td>
                                                {% elif "tb_prev" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        -
                                                    </td>
                                                {% elif "results_pnc<=6 weeks" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "haart_pnc<= 6 weeks" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "prophyl_pnc<= 6 weeks" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "positive (pmtct)" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.kp_anc_total|add:total.new_pos_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "haart total" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_on_haart_anc_total|add:total.on_haart_anc_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "infant prophylaxis" in data.indicator|lower %}
                                                    <td class="align-middle text-center fw-bold">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "under 15yrs starting" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_p_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "above 15yrs starting" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_a_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "children starting art" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_a_total|add:total.tx_new_p_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "relapse tb_cases" in data.indicator|lower %}
                                                    <td class="align-middle text-center text-white fw-bold"
                                                        style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tb_stat_d_total %}green{% else %}red{% endif %}">
                                                        {{ data.total_731moh }}
                                                    </td>
                                                {% elif "art <15years" in data.indicator|lower %}
                                                    <!--COMPARE SOURCE, MOH 731 AND KHIS -->
                                                    {% for p in khis_performance %}
                                                        {% if forloop.last %}
                                                            {% with khis_tx_curr_p=p.tx_curr_p|floatformat %}
                                                                {% with source_tx_curr_p=data.field_3|floatformat %}
                                                                    {% with moh_731_tx_curr_p=data.field_7|floatformat %}
                                                                        <td class="align-middle text-center text-white fw-bold"
                                                                            style="background-color: {% if source_tx_curr_p == moh_731_tx_curr_p and moh_731_tx_curr_p ==  khis_tx_curr_p %}green{% else %}red{% endif %}">
                                                                            {{ moh_731_tx_curr_p }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endwith %}
                                                        {% endif %}
                                                    {% endfor %}
                                                {% elif "art 15+ years" in data.indicator|lower %}
                                                    <!--COMPARE SOURCE, MOH 731 AND KHIS-->
                                                    {% for p in khis_performance %}
                                                        {% if forloop.last %}
                                                            {% with khis_tx_curr_a=p.tx_curr_a|floatformat %}
                                                                {% with source_tx_curr_a=data.field_3|floatformat %}
                                                                    {% with moh_731_tx_curr_a=data.field_7|floatformat %}
                                                                        <td class="align-middle text-center text-white fw-bold"
                                                                            style="background-color: {% if source_tx_curr_a == moh_731_tx_curr_a and moh_731_tx_curr_a ==  khis_tx_curr_a %}green{% else %}red{% endif %}">
                                                                            {{ moh_731_tx_curr_a }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endwith %}
                                                        {% endif %}
                                                    {% endfor %}

                                                {% elif "children currently on art" in data.indicator|lower %}
                                                    <!--COMPARE SOURCE, MOH 731 AND KHIS-->
                                                    {% for p in khis_performance %}
                                                        {% if forloop.last %}
                                                            {% with khis_tx_curr_p=p.tx_curr_a|add:p.tx_curr_p|floatformat %}
                                                                <td class="align-middle text-center text-white fw-bold"
                                                                    style="background-color: {% if data.field_3|floatformat == data.field_7|floatformat and data.field_7|floatformat ==  khis_tx_curr_p %}green{% else %}red{% endif %}">
                                                                    {{ data.field_7 }}
                                                                </td>
                                                            {% endwith %}
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                                <!-- KHIS RAW DATA-->
                                                {% for performance in khis_performance %}
                                                    {% if "prep" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.prep_new }}</td>
                                                    {% elif "tpt" in data.indicator|lower %}

                                                        <td class="align-middle text-center">{{ performance.ipt }}</td>
                                                    {% elif "sex" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.gbv_sexual }}</td>
                                                    {% elif "emot" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.gbv_emotional_physical }}</td>
                                                    {% elif "cancer" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.cx_ca }}</td>
                                                    {% elif "l test" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tst_t }}</td>
                                                    {% elif "aged <15 years" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tst_pos_p }}</td>
                                                    {% elif "aged 15+ years" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tst_pos_a }}</td>
                                                    {% elif "_total" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tst_pos_a|add:performance.tst_pos_p }}</td>
                                                    {% elif "n positive at 1st anc" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.kp_anc }}</td>
                                                    {% elif "results_anc" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.new_pos_anc }}</td>
                                                    {% elif "on haart" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.on_haart_anc }}</td>
                                                    {% elif "haart anc" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.new_on_haart_anc }}</td>
                                                    {% elif "prophyl_anc" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.infant_arv_prophyl_anc }}</td>
                                                    {% elif "results_l&d" in data.indicator|lower %}
                                                        <td class="align-middle text-center">
                                                            {{ performance.pos_l_d }}
                                                        </td>
                                                    {% elif "haart_l&d" in data.indicator|lower %}
                                                        <td class="align-middle text-center">
                                                            {{ performance.haart_l_d }}
                                                        </td>
                                                    {% elif "prophyl_l&d" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.infant_arv_prophyl_l_d }}</td>
                                                    {% elif "tx_ml" in data.indicator|lower %}
                                                        <td class="align-middle text-center">-</td>
                                                    {% elif "rtt" in data.indicator|lower %}
                                                        <td class="align-middle text-center">-</td>
                                                    {% elif "tb_prev" in data.indicator|lower %}
                                                        <td class="align-middle text-center">-</td>
                                                    {% elif "results_pnc<=6 weeks" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.pos_results_pnc_lt6wks }}</td>
                                                    {% elif "haart_pnc<= 6 weeks" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.start_haart_pnc_lt6wks }}</td>
                                                    {% elif "prophyl_pnc<= 6 weeks" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.infant_arv_prophyl_lt8wks_pnc }}</td>
                                                    {% elif "positive (pmtct)" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.kp_anc|add:performance.new_pos_anc }}</td>
                                                    {% elif "haart total" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.new_on_haart_anc|add:performance.on_haart_anc }}</td>
                                                    {% elif "infant prophylaxis" in data.indicator|lower %}
                                                        <td class="align-middle text-center">
                                                            {{ performance.infant_arv_prophyl_lt8wks_pnc|add:performance.infant_arv_prophyl_l_d|add:performance.infant_arv_prophyl_anc }}
                                                        </td>
                                                    {% elif "under 15yrs starting" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tx_new_p }}</td>
                                                    {% elif "above 15yrs starting" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tx_new_a }}</td>
                                                    {% elif "children starting art" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tx_new_a|add:performance.tx_new_p }}</td>
                                                    {% elif "relapse tb_cases" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tb_stat_d }}</td>
                                                    {% elif "art <15years" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tx_curr_p }}</td>
                                                    {% elif "art 15+ years" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tx_curr_a }}</td>
                                                    {% elif "children currently on art" in data.indicator|lower %}
                                                        <td class="align-middle text-center">{{ performance.tx_curr_a|add:performance.tx_curr_p }}</td>
                                                    {% endif %}
                                                {% endfor %}
                                                <!-- KHIS TOTALS-->
                                                {% for performance in khis_performance %}
                                                    {% if forloop.last %}
                                                        {% if "prep" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.prep_new_total %}green{% else %}red{% endif %}">
                                                                {{ total.prep_new_total }}
                                                            </td>
                                                        {% elif "tpt" in data.indicator|lower %}

                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.ipt_total %}green{% else %}red{% endif %}">
                                                                {{ total.ipt_total }}
                                                            </td>
                                                        {% elif "sex" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.gbv_sexual_total %}green{% else %}red{% endif %}">
                                                                {{ total.gbv_sexual_total }}
                                                            </td>
                                                        {% elif "emot" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "cancer" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.cx_ca_total %}green{% else %}red{% endif %}">
                                                                {{ total.cx_ca_total }}
                                                            </td>
                                                        {% elif "l test" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_t_total %}green{% else %}red{% endif %}">
                                                                {{ total.tst_t_total }}
                                                            </td>
                                                        {% elif "aged <15 years" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_p_total %}green{% else %}red{% endif %}">
                                                                {{ total.tst_pos_p_total }}
                                                            </td>
                                                        {% elif "aged 15+ years" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_a_total %}green{% else %}red{% endif %}">
                                                                {{ total.tst_pos_a_total }}
                                                            </td>
                                                        {% elif "_total" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tst_pos_a_total|add:total.tst_pos_p_total %}green{% else %}red{% endif %}">
                                                                {{ total.tst_pos_a_total|add:total.tst_pos_p_total }}
                                                            </td>
                                                        {% elif "n positive at 1st anc" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.kp_anc_total %}green{% else %}red{% endif %}">
                                                                {{ total.kp_anc_total }}
                                                            </td>
                                                        {% elif "results_anc" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_pos_anc_total %}green{% else %}red{% endif %}">
                                                                {{ total.new_pos_anc_total }}
                                                            </td>
                                                        {% elif "on haart" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.on_haart_anc_total %}green{% else %}red{% endif %}">
                                                                {{ total.on_haart_anc_total }}
                                                            </td>
                                                        {% elif "haart anc" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_on_haart_anc_total %}green{% else %}red{% endif %}">
                                                                {{ total.new_on_haart_anc_total }}
                                                            </td>
                                                        {% elif "prophyl_anc" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "results_l&d" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "haart_l&d" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "prophyl_l&d" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "tx_ml" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "rtt" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "tb_prev" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "results_pnc<=6 weeks" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "haart_pnc<= 6 weeks" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "prophyl_pnc<= 6 weeks" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "positive (pmtct)" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.kp_anc_total|add:total.new_pos_anc_total %}green{% else %}red{% endif %}">
                                                                {{ total.kp_anc_total|add:total.new_pos_anc_total }}
                                                            </td>
                                                        {% elif "haart total" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.new_on_haart_anc_total|add:total.on_haart_anc_total %}green{% else %}red{% endif %}">
                                                                {{ total.new_on_haart_anc_total|add:total.on_haart_anc_total }}
                                                            </td>
                                                        {% elif "infant prophylaxis" in data.indicator|lower %}
                                                            <td class="align-middle text-center fw-bold">
                                                                -
                                                            </td>
                                                        {% elif "under 15yrs starting" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_p_total %}green{% else %}red{% endif %}">
                                                                {{ total.tx_new_p_total }}
                                                            </td>
                                                        {% elif "above 15yrs starting" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_a_total %}green{% else %}red{% endif %}">
                                                                {{ total.tx_new_a_total }}
                                                            </td>
                                                        {% elif "children starting art" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tx_new_a_total|add:total.tx_new_p_total %}green{% else %}red{% endif %}">
                                                                {{ total.tx_new_a_total|add:total.tx_new_p_total }}
                                                            </td>
                                                        {% elif "relapse tb_cases" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.total_source|add:"0" == data.total_731moh|add:"0" and data.total_731moh|add:"0" == total.tb_stat_d_total %}green{% else %}red{% endif %}">
                                                                {{ total.tb_stat_d_total }}
                                                            </td>
                                                        {% elif "art <15years" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.field_3|floatformat == data.field_7|floatformat and data.field_7|floatformat ==  performance.tx_curr_p|floatformat %}green{% else %}red{% endif %}">
                                                                {{ performance.tx_curr_p }}
                                                            </td>
                                                        {% elif "art 15+ years" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.field_3|floatformat == data.field_7|floatformat and data.field_7|floatformat ==  performance.tx_curr_a|floatformat %}green{% else %}red{% endif %}">
                                                                {{ performance.tx_curr_a }}
                                                            </td>
                                                        {% elif "children currently on art" in data.indicator|lower %}
                                                            <td class="align-middle text-center text-white fw-bold"
                                                                style="background-color: {% if data.field_3|floatformat == data.field_7|floatformat and data.field_7|floatformat == performance.tx_curr_a|add:performance.tx_curr_p|floatformat %}green{% else %}red{% endif %}">
                                                                {{ performance.tx_curr_a|add:performance.tx_curr_p }}
                                                            </td>
                                                        {% endif %}
                                                    {% endif %}
                                                {% endfor %}
                                                <!-- DATIM TOTALS-->
                                                {% for performance in fyj_performance %}
                                                    {% if "prep" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.prep_new_total == performance.prep_new %}green{% else %}red{% endif %}">
                                                            {{ performance.prep_new }}</td>
                                                    {% elif "tpt" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.ipt_total == performance.ipt %}green{% else %}red{% endif %}">
                                                            {{ performance.ipt }}</td>
                                                    {% elif "sex" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.gbv_sexual_total == performance.gbv_sexual %}green{% else %}red{% endif %}">
                                                            {{ performance.gbv_sexual }}</td>
                                                    {% elif "emot" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">
                                                            {{ performance.gbv_emotional_physical }}</td>
                                                    {% elif "cancer" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.cx_ca_total == performance.cx_ca %}green{% else %}red{% endif %}">
                                                            {{ performance.cx_ca }}</td>
                                                    {% elif "l test" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.tst_t_total == performance.tst_t %}green{% else %}red{% endif %}">
                                                            {{ performance.tst_t }}</td>
                                                    {% elif "aged <15 years" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.tst_pos_p_total == performance.tst_pos_p %}green{% else %}red{% endif %}">
                                                            {{ performance.tst_pos_p }}</td>
                                                    {% elif "aged 15+ years" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.tst_pos_a_total == performance.tst_pos_a %}green{% else %}red{% endif %}">
                                                            {{ performance.tst_pos_a }}</td>
                                                    {% elif "_total" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.tst_pos_p_total|add:total.tst_pos_a_total == performance.tst_pos_a|add:performance.tst_pos_p %}green{% else %}red{% endif %}">
                                                            {{ performance.tst_pos_a|add:performance.tst_pos_p }}</td>
                                                    {% elif "n positive at 1st anc" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.kp_anc_total == performance.kp_anc %}green{% else %}red{% endif %}">
                                                            {{ performance.kp_anc }}</td>
                                                    {% elif "results_anc" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.new_pos_anc_total == performance.new_pos_anc %}green{% else %}red{% endif %}">
                                                            {{ performance.new_pos_anc }}</td>
                                                    {% elif "on haart" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.on_haart_anc_total == performance.on_haart_anc %}green{% else %}red{% endif %}">
                                                            {{ performance.on_haart_anc }}</td>
                                                    {% elif "haart anc" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.new_on_haart_anc_total == performance.new_on_haart_anc %}green{% else %}red{% endif %}">
                                                            {{ performance.new_on_haart_anc }}</td>
                                                    {% elif "prophyl_anc" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">-</td>
                                                    {% elif "results_l&d" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">-</td>
                                                    {% elif "haart_l&d" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">-</td>
                                                    {% elif "prophyl_l&d" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">-</td>
                                                    {% elif "tx_ml" in data.indicator|lower %}
                                                        <!--COMPARE SOURCE/REGISTER TX_ML WITH DATIM TX_ML-->
                                                        {% for data in data_verification %}
                                                            {% if "tx_ml" in data.indicator|lower %}
                                                                {% with source_tx_ml=data.total_source|floatformat %}
                                                                    {% with performance_tx_ml=performance.tx_ml|floatformat %}
                                                                        <td class="align-middle text-center fw-bold"
                                                                            style="background-color: {% if source_tx_ml == performance_tx_ml %}green{% else %}red{% endif %}">
                                                                            {{ performance_tx_ml }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% elif "rtt" in data.indicator|lower %}
                                                        <!--COMPARE SOURCE/REGISTER RTT WITH DATIM RTT-->
                                                        {% for data in data_verification %}
                                                            {% if "rtt" in data.indicator|lower %}
                                                                {% with source_rtt=data.total_source|floatformat %}
                                                                    {% with performance_tx_rtt=performance.tx_rtt|floatformat %}
                                                                        <td class="align-middle text-center fw-bold"
                                                                            style="background-color: {% if source_rtt == performance_tx_rtt %}green{% else %}red{% endif %}">
                                                                            {{ performance_tx_rtt }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% elif "tb_prev" in data.indicator|lower %}
                                                        <!--COMPARE SOURCE/REGISTER TB_PREV WITH DATIM TB_PREV-->
                                                        {% for data in data_verification %}
                                                            {% if "tb_prev" in data.indicator|lower %}
                                                                {% with source_tb_prev_n=data.total_source|floatformat %}
                                                                    {% with performance_tb_prev_n=performance.tb_prev_n|floatformat %}
                                                                        <td class="align-middle text-center fw-bold"
                                                                            style="background-color: {% if source_tb_prev_n == performance_tb_prev_n %}green{% else %}red{% endif %}">
                                                                            {{ performance_tb_prev_n }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% elif "results_pnc<=6 weeks" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">-</td>
                                                    {% elif "haart_pnc<= 6 weeks" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">-</td>
                                                    {% elif "prophyl_pnc<= 6 weeks" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">-</td>
                                                    {% elif "positive (pmtct)" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.kp_anc_total|add:total.new_pos_anc_total == performance.kp_anc|add:performance.new_pos_anc %}green{% else %}red{% endif %}">
                                                            {{ performance.kp_anc|add:performance.new_pos_anc }}</td>
                                                    {% elif "haart total" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.new_on_haart_anc_total|add:total.on_haart_anc_total == performance.new_on_haart_anc|add:performance.on_haart_anc %}green{% else %}red{% endif %}">
                                                            {{ performance.new_on_haart_anc|add:performance.on_haart_anc }}</td>
                                                    {% elif "infant prophylaxis" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold">-</td>
                                                    {% elif "under 15yrs starting" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.tx_new_p_total == performance.tx_new_p %}green{% else %}red{% endif %}">
                                                            {{ performance.tx_new_p }}</td>
                                                    {% elif "above 15yrs starting" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.tx_new_a_total == performance.tx_new_a %}green{% else %}red{% endif %}">
                                                            {{ performance.tx_new_a }}</td>
                                                    {% elif "children starting art" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.tx_new_p_total|add:total.tx_new_a_total == performance.tx_new_a|add:performance.tx_new_p %}green{% else %}red{% endif %}">
                                                            {{ performance.tx_new_a|add:performance.tx_new_p }}
                                                        </td>
                                                    {% elif "relapse tb_cases" in data.indicator|lower %}
                                                        <td class="align-middle text-center fw-bold"
                                                            style="background-color: {% if total.tb_stat_d_total == performance.tb_stat_d %}green{% else %}red{% endif %}">
                                                            {{ performance.tb_stat_d }}</td>
                                                    {% elif "art <15years" in data.indicator|lower %}
                                                        <!--COMPARE LAST MONTH <15 TX_CURR WITH DATIM < 15 TX_CURR-->
                                                        {% for p in khis_performance %}
                                                            {% if forloop.last %}
                                                                {% with tx_curr_p=p.tx_curr_p|floatformat %}
                                                                    {% with datim_tx_curr_p=performance.tx_curr_p|floatformat %}
                                                                        <td class="align-middle text-center fw-bold"
                                                                            style="background-color: {% if tx_curr_p == datim_tx_curr_p %}green{% else %}red{% endif %}">
                                                                            {{ performance.tx_curr_p }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% elif "art 15+ years" in data.indicator|lower %}
                                                        <!--COMPARE LAST MONTH >15 TX_CURR WITH DATIM > 15 TX_CURR-->
                                                        {% for p in khis_performance %}
                                                            {% if forloop.last %}
                                                                {% with tx_curr_a=p.tx_curr_a|floatformat %}
                                                                    {% with datim_tx_curr_a=performance.tx_curr_a|floatformat %}
                                                                        <td class="align-middle text-center fw-bold"
                                                                            style="background-color: {% if tx_curr_a == datim_tx_curr_a %}green{% else %}red{% endif %}">
                                                                            {{ performance.tx_curr_a }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% elif "children currently on art" in data.indicator|lower %}
                                                        <!--COMPARE LAST MONTH TX_CURR WITH DATIM TX_CURR-->
                                                        {% for p in khis_performance %}
                                                            {% if forloop.last %}
                                                                {% with tx_curr_a=p.tx_curr_a|add:p.tx_curr_p|floatformat %}
                                                                    {% with tx_curr_total=performance.tx_curr_a|add:performance.tx_curr_p|floatformat %}
                                                                        <td class="align-middle text-center fw-bold"
                                                                            style="background-color: {% if tx_curr_a == tx_curr_total %}green{% else %}red{% endif %}">
                                                                            {{ tx_curr_total }}
                                                                        </td>
                                                                    {% endwith %}
                                                                {% endwith %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% endif %}
                                                {% endfor %}
                                                {% if "_total" in data.indicator|lower or "positive (pmtct)" in data.indicator|lower or "haart total" in data.indicator|lower or "children currently on art" in data.indicator|lower or "children starting art" in data.indicator|lower or "infant prophylaxis" in data.indicator|lower %}

                                                {% else %}
                                                    {% if not data.hide_update_button or request.user.is_superuser %}
                                                        <td class="text-center">
                                                            <a href="{% url 'update_data_verification' data.id %}"
                                                               class="btn btn-info"
                                                               role="button" id="update-btn-{{ data.id }}">Update</a>
                                                        </td>
                                                    {% endif %}
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                    {% endif %}
                                    </tbody>
                                </table>
                            {% endif %}
                        </div>
                    </div>



                    <form class="row mt-5" method="POST" enctype='multipart/form-data' autocomplete="off">
                        {% csrf_token %}

                        <div class="col-md-6 mt-4">
                            {{ form.dqa_date|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.program_areas_reviewed|as_crispy_field }}
                        </div>
                        <div class="col-md-4 mt-4">
                            {{ form.strengths_identified|as_crispy_field }}
                        </div>
                        <div class="col-md-4 mt-4">
                            {{ form.gaps_identified|as_crispy_field }}
                        </div>
                        <div class="col-md-4 mt-4">
                            {{ form.individuals_conducting_dqa|as_crispy_field }}
                        </div>
                        <div class="col-md-4 mt-4">
                            {{ form.recommendation|as_crispy_field }}
                        </div>
                        <div class="col-md-4 mt-4">
                            {{ form.individuals_responsible|as_crispy_field }}
                        </div>

                        <div class="col-md-4 mt-4">
                            {{ form.comments|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.percent_completed|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.due_complete_by|as_crispy_field }}
                        </div>

                        <div class="col-md-12 mt-3">
                            <input class="btn btn-success mt-1" type="submit" value="Submit">
                        </div>
                        {% if form.errors %}
                            <div class="alert alert-danger mt-4">
                                {{ form.errors }}
                            </div>
                        {% endif %}
                    </form>


                {% elif "SUSTAINMENT PLAN" in title %}
                    <div class="d-flex justify-content-between">
                        <div>
                            <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapserootcause" role="button"
                               aria-expanded="false" aria-controls="collapserootcause">
                                SUSTAINMENT PLAN IN BRIEF
                            </a>
                        </div>

                        {#                        <a href="{% url 'single_project_comments' facility_project.id %}" class="btn btn-outline-primary">View QI Project comments</a>#}
                    </div>

                    <div class="collapse bg-light mt-2" id="collapserootcause">
                        <p>Ensuring the longevity of the improvements made during a quality improvement project is a
                            part
                            of the sustainment plan. The plan captures all the vital information needed to maintain
                            progress
                            , including objectives, metrics for measuring success, communication plan, budget, risks,
                            training and support, feedback mechanisms, and reaction plan.
                        </p>
                        <p>
                            The RACI matrix outlines the roles and responsibilities of each person involved in the
                            sustainment plan, helping to ensure that everyone is aware of their part in maintaining the
                            improvements. This information will help track the progress of the sustainment plan and keep
                            all
                            stakeholders informed of their responsibilities.
                        </p>


                        <p>
                            This section will provide you with a comprehensive understanding of the key elements of a
                            successful Sustainment Plan and its critical role in ensuring the sustainability of
                            improvements made during a quality improvement project.
                        </p>
                        <p>
                            The information captured in the Sustainment Plan serves as a guide to ensure that we take
                            all
                            necessary steps to maintain progress and overcome any challenges that may arise during the
                            sustainment phase. By planning and documenting all aspects of the sustainment plan
                            carefully,
                            you increase the likelihood of success and ensure the long-term sustainability of your
                            quality
                            improvement project.
                        </p>

                    </div>
                    <form class="row mt-5" method="POST" enctype='multipart/form-data' autocomplete="off">
                        {% csrf_token %}
                        {#                        <div class="col-md-12 mt-4">#}
                        {#                            {{ form.qi_project|as_crispy_field }}#}
                        {#                        </div>#}
                        <div class="col-md-6 mt-4 mb-5">
                            <div class="col-md-12 mt-4">
                                {{ form.start_date|as_crispy_field }}
                            </div>
                            <div class="col-md-12 mt-5">
                                {{ form.end_date|as_crispy_field }}
                            </div>
                        </div>

                        <div class="col-md-6 mt-4">
                            {{ form.objectives|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.metrics|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.communication_plan|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.risks|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.budget|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.mitigation|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.training_and_support|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.feedback_mechanisms|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {{ form.reaction_plan|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {#                           <p>Tick the name of the person responsible for this specific task.</p>#}
                            {{ form.responsible|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {#                           <p>Tick the name of the name person who is accountable for ensuring the task is completed#}
                            {#                               successfully.#}
                            {#                           </p>#}
                            {{ form.accountable|as_crispy_field }}
                        </div>
                        <div class="col-md-6 mt-4">
                            {#                           <p>Tick the name of any individuals or groups who should be consulted#}
                            {#                               in the decision-making process.#}
                            {#                           </p>#}
                            {{ form.consulted|as_crispy_field }}
                        </div>

                        <div class="col-md-6 mt-4">
                            {#                           <p>Tick the names of any individuals or groups who should be kept informed of#}
                            {#                               the task progress and outcome.</p>#}
                            {{ form.informed|as_crispy_field }}
                        </div>
                        <div class="col-md-12 mt-3">
                            <input class="btn btn-success mt-1" type="submit" value="Submit">
                        </div>
                        {% if form.errors %}
                            <div class="alert alert-danger mt-4">
                                {{ form.errors }}
                            </div>
                        {% endif %}
                    </form>

                {% else %}
                    <form method="POST" class="mt-5" enctype='multipart/form-data'>
                        {% csrf_token %}
                        {{ form|crispy }}
                        <input class="btn btn-success mt-1" type="submit" value="Submit">
                    </form>

                {% endif %}


        </div>
        </div>
    </main>
{% endblock %}