{% load static %}
{% block navbar %}{% endblock %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.104.2">
    <title>USAID UON-FYJ {% block title %} {% endblock %}</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/dashboard/">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/footers/">
    <link href="{% static 'assets/dist/css/bootstrap.min.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'assets/fonts/icomoon/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/rome.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/smoothness/jquery-ui.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .b-example-divider {
            height: 3rem;
            background-color: rgba(0, 0, 0, .1);
            border: solid rgba(0, 0, 0, .15);
            border-width: 1px 0;
            box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
        }

        .b-example-vr {
            flex-shrink: 0;
            width: 1.5rem;
            height: 100vh;
        }

        .bi {
            vertical-align: -.125em;
            fill: currentColor;
        }

        .nav-scroller {
            position: relative;
            z-index: 2;
            height: 2.75rem;
            overflow-y: hidden;
        }

        .nav-scroller .nav {
            display: flex;
            flex-wrap: nowrap;
            padding-bottom: 1rem;
            margin-top: -1px;
            overflow-x: auto;
            text-align: center;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        table {
            font-size: smaller;
        }

        nav {
            font-size: 10px;
        }

        form {
            font-size: 12px;
        }

        .btn {
            font-size: 10px;
            box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
        }

        .card {
            font-size: 12px;
        }

        .form-control {
            font-size: small;
        }

        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeeba;
        }

        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }

        .alert-danger {
            color: #f2f5f3;
            background-color: #c73c30;
            border-color: #bee5eb;
        }

        .alert-success {
            color: #f2f5f3;
            background-color: #4eed09;
            border-color: #bee5eb;
        }

        table {
            width: 100%;
        }

        .my-table {
            position: relative;
        {#z-index: 1; /* this will make the table appear above the navbar */#}
        }

        thead {
            background-color: #6c757d;
            color: #fff;
            position: sticky;
            top: 56px; /* this will make the table header stick 56px below the navbar */
            z-index: 1; /* ensure that the thead is above other table content */
        }

        .comments-card {
            max-width: 100%;
        }

        .sub-reply {
            padding-left: 100px;
        }

        .full-width-input {
            width: 100%;
        }

        {#    table td {#}
        {#    width: 1em;#}
        {#    height: 50px;#}
        {#    text-align: left;#}
        {#    vertical-align: top;#}
        {#padding: 10px;#}

        td {
        {#width: 50px;#}{#height: 20px;#} font-size: 12px;
        {#overflow: hidden;#}{#text-overflow: ellipsis;#}{#white-space: nowrap;#}
        }

        /* Add a class of animated to the element to be animated */
        .animated {
            /* Set the duration of the animation to 5 seconds */
            animation-duration: 5s;
            /* Make sure the element retains its state after the animation is complete */
            animation-fill-mode: both;
        }

        /* Define the keyframes of the fade-in animation */
        @keyframes fadeIn {
            /* Start the animation with the element having an opacity of 0 */
            from {
                opacity: 0;
            }
            /* End the animation with the element having an opacity of 1 */
            to {
                opacity: 1;
            }
        }

        /* Add a class of fadeIn to the element to trigger the fade-in animation */
        .fadeIn {
            /* Assign the fade-in animation to the element */
            animation-name: fadeIn;
        }


        .flicker-button {
            /* This selector is used to add style to the button element with the class name "flicker-button" */
            animation: flicker 5s infinite;
            /* The animation property is applied to the button with the value "flicker" for 1 second, with infinite repetition */
        }

        @keyframes flicker {
            /* The keyframes define the animation for the "flicker" animation */
            0% {
                background-color: green;
            }
            /* At 0% of the animation, the background color of the button is set to green */
            50% {
                background-color: red;
            }
            /* At 50% of the animation, the background color of the button is set to red */
            100% {
                background-color: green;
            }
            /* At 100% of the animation, the background color of the button is set back to green */
        }

        textarea[name="description"] {
            background-color: grey;
        }

        .chart-container {
        {#height: 300px; /* adjust to your desired height */#} width: 100%; /* make the chart take up the full width of the container */
        }
    </style>

    <!-- Custom styles for this template -->
    <link href="{% static 'dashboard.css' %}" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>

    <!-- Fengyuan Chen's Datepicker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.min.css"
          integrity="sha256-b88RdwbRJEzRx95nCuuva+hO5ExvXXnpX+78h8DjyOE=" crossorigin="anonymous"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.min.js"
            integrity="sha256-/7FLTdzP6CfC1VBAj/rsp3Rinuuu9leMRGd354hvk0k=" crossorigin="anonymous"></script>
</head>
{% block top_nav %}{% endblock %}
<body>
<!-- BODY -->
<div class="container-fluid">
    <div class="row">
        {% block content %} {% endblock %}
    </div>
</div>
<!-- JS SCRIPTS -->
<script src="{% static 'assets/dist/js/bootstrap.bundle.min.js' %}"></script>

<script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"
        integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"
        integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha"
        crossorigin="anonymous"></script>
<script src="{% static 'dashboard.js' %}"></script>
<script>
    $(function () {
        $("#id_start_date").datepicker();
        $("#id_end_date").datepicker();
        $("#id_due_date").datepicker();
        $("#id_month_year").datepicker();
        $("#id_dqa_date").datepicker();
        $("#id_due_complete_by").datepicker();
        $("#id_collection_date_gte").datepicker();
        $("#id_collection_date_lte").datepicker();
        $("#id_data_submitted_from").datepicker();
        $("#id_data_submitted_to").datepicker();

    });
</script>

<script>
    let navbar = document.getElementById("navbar");
    let navbarHeight = navbar.offsetHeight;
    let table = document.getElementsByClassName("my-table")[0];
    table.style.marginTop = navbarHeight + 'px';
</script>

<!--This enables searching and filtering the dropdown-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.min.js"></script>
<script>
    $(document).ready(function () {
        $('.select2').select2();
    });
</script>

<script>
    // Get references to the fields
    const receivedStatusField = document.querySelector('#id_received_status');
    const dateOfTestingField = document.querySelector('#id_date_of_testing');
    const cd4CountResultsField = document.querySelector('#id_cd4_count_results');
    const cd4PercentageField = document.querySelector('#id_cd4_percentage');
    const tbLamResultsField = document.querySelector('#id_tb_lam_results');
    const serumCragResultsField = document.querySelector('#id_serum_crag_results');
    const reasonNoSerumCragField = document.querySelector('#id_reason_for_no_serum_crag');
    const ageField = document.querySelector('#id_age');
    const rejectionReasonField = document.querySelector('#id_reason_for_rejection');

    // Function to enable or disable the cd4_percentage field
    function toggleCd4Percentage() {
        const receivedStatus = receivedStatusField.value;
        const age = parseFloat(ageField.value);

        if (receivedStatus === "Rejected" || (receivedStatus === "Accepted" && age > 5) || age > 5) {
            cd4PercentageField.disabled = true;
            cd4PercentageField.value = "";
        } else {
            cd4PercentageField.disabled = false;
        }
    }

    // Call the function on page load
    toggleCd4Percentage();

    // Bind the function to the change event of the age and receivedStatus fields
    ageField.addEventListener('change', toggleCd4Percentage);
    receivedStatusField.addEventListener('change', toggleCd4Percentage);


    // Function to enable or disable the date_of_testing field
    function toggleFieldsUponRejection() {
        const receivedStatus = receivedStatusField.value;

        if (receivedStatus === 'Rejected') {
            [dateOfTestingField, cd4CountResultsField, tbLamResultsField, cd4PercentageField, serumCragResultsField,
                reasonNoSerumCragField].forEach(field => {
                field.disabled = true;
                field.value = "";
            });
        } else {
            [dateOfTestingField, cd4CountResultsField, tbLamResultsField, cd4PercentageField, serumCragResultsField,
                reasonNoSerumCragField].forEach(field => {
                field.disabled = false;
            });
            // Enable cd4PercentageField if the conditions are met
            toggleCd4Percentage();
            {#toggleCragField();#}
        }
    }

    // Call the function on page load
    toggleFieldsUponRejection();

    // Bind the function to the change event of the received_status field
    receivedStatusField.addEventListener('change', toggleFieldsUponRejection);

    // Function to enable or disable the reason_for_rejection field
    function toggleRejectionReason() {
        if (receivedStatusField.value === 'Accepted') {
            rejectionReasonField.disabled = true;
            rejectionReasonField.value = "";
        } else {
            rejectionReasonField.disabled = false;
        }
    }

    // Call the function on page load
    toggleRejectionReason();

    // Bind the function to the change event of the received_status field
    receivedStatusField.addEventListener('change', toggleRejectionReason);

    {#// Function to enable or disable the serum_crag_results field#}
    {#function toggleCragField() {#}
    {#    const cd4CountValue = cd4CountResultsField.value;#}
    {##}
    {#    if (cd4CountValue !== "" && parseFloat(cd4CountValue) > 200) {#}
    {#        serumCragResultsField.disabled = true;#}
    {#        serumCragResultsField.value = "";#}
    {#        reasonNoSerumCragField.disabled = true;#}
    {#        reasonNoSerumCragField.value = "";#}
    {#        tbLamResultsField.disabled = true;#}
    {#        tbLamResultsField.value = "";#}
    {#    } else {#}
    {#        serumCragResultsField.disabled = false;#}
    {#        tbLamResultsField.disabled = false;#}
    {#        reasonNoSerumCragField.disabled = false;#}
    {#    }#}
    //}
    {##}
    {#// Call the function on page load#}
    {#toggleCragField();#}
    {##}
    {#// Bind the function to the change event of the cd4_count_results field#}
    {#cd4CountResultsField.addEventListener('change', toggleCragField);#}

    // Function to enable or disable the reason_for_no_serum_crag field
    function toggleNoCragReason() {
        const cd4CountValue = cd4CountResultsField.value;
        if (serumCragResultsField.value !== "" && parseFloat(cd4CountValue) <= 200) {
            reasonNoSerumCragField.disabled = true;
            reasonNoSerumCragField.value = "";
        } else {
            reasonNoSerumCragField.disabled = false;
            // Enable reasonNoSerumCragField if the conditions are met
            {#toggleCragField()#}
        }
    }

    // Call the function on page load
    toggleNoCragReason();

    // Bind the function to the change event of the received_status field
    serumCragResultsField.addEventListener('change', toggleNoCragReason);
</script>

<!-- Show uploaded files dynamically -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fileInput = document.querySelector('input[type="file"]');
        const fileList = document.getElementById('uploaded-files-list');
        const uploadedFilesLabel = document.querySelector('#uploaded-files-label');

        // Function to update the file list
        function updateFileList() {
            let fileNames = '';
            for (let i = 0; i < fileInput.files.length; i++) {
                fileNames += '<li>' + fileInput.files[i].name + '</li>';
            }
            fileList.innerHTML = fileNames;

            // Show/hide label based on uploaded files
            uploadedFilesLabel.style.display = fileInput.files.length > 0 ? 'block' : 'none';
        }

        // Update file list on file selection
        fileInput.addEventListener('change', function () {
            updateFileList();
        });
    });
</script>
<script>
    // This script is designed to toggle the visibility of the summary section
    // when the "Show/Hide Summary" button is clicked.
    $(document).ready(function () {
        // Attach the click event to the toggle buttons
        $('#toggleSummaryTop, #toggleSummaryBottom').on('click', function () {
            // Toggle the visibility of the summary section
            $('#collapse_summary').toggleClass('show');
            // Update the label text based on visibility
            updateLabel();
        });

        // Function to update the label text
        function updateLabel() {
            // Get the label element associated with the toggle buttons
            const label = $('#toggleSummaryTop, #toggleSummaryBottom').next('.form-check-label');
            // Check if the summary section is visible
            const isVisible = $('#collapse_summary').hasClass('show');
            // Update the label text accordingly
            label.text(isVisible ? 'Hide Summary' : 'Show Summary');
        }
    });
</script>


<script>
    /// This script is designed to reset the form when the document is fully loaded
    document.addEventListener("DOMContentLoaded", () => {
        const filterForm = document.getElementById('filter-form');

        // Array of fields to be reset
        const fieldsToReset = ['#id_county', '#id_sub_county', '#id_facility_name', '#id_testing_laboratory',
            '#id_haart_class', '#id_sequence_summary'];

        // Function to reset the form
        const resetForm = () => {
            // Reset the form fields
            filterForm.reset();

            // Clear the values in specific fields using select2
            fieldsToReset.forEach((field) => {
                $(field).val(null).trigger('change.select2');
                $(field).select2('destroy').select2();
            });
        };

        // Attach the resetForm function to the reset button click event
        document.getElementById('reset-button').addEventListener('click', (event) => {
            event.preventDefault(); // Prevent the default form submission
            resetForm(); // Call the resetForm function
        });
    });

</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var sequenceSummaryField = document.getElementById("id_sequence_summary");
        var fileFields = document.getElementById("id_files");
        var patientUniqueNoInput = document.getElementById("id_patient_unique_no");

        // Initial check and hide/show based on the initial value
        checkSequenceSummaryValue();

        // Attach an event listener to sequence_summary field to check and update visibility
        sequenceSummaryField.addEventListener("change", checkSequenceSummaryValue);

        function checkSequenceSummaryValue() {
            var sequenceSummaryValue = sequenceSummaryField.value;

            // Check if the value is "FAILED"
            if (sequenceSummaryValue === "FAILED") {
                // Hide the files input
                fileFields.style.display = "block";
                document.getElementById("files-input").style.display = "none";
                document.getElementById("patient-unique-input").style.display = "block";
                // Make the files input not required
                fileFields.removeAttribute("required");
                patientUniqueNoInput.setAttribute("required", "required");
            } else {
                // Show the files input
                fileFields.style.display = "block";
                document.getElementById("files-input").style.display = "block";
                document.getElementById("patient-unique-input").style.display = "none";
                // Make the files input required
                fileFields.setAttribute("required", "required");
                patientUniqueNoInput.removeAttribute("required");
            }
        }
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to disable haart_class and resistance_level when sequence_summary is "FAILED"
        function toggleFieldsBasedOnSequenceSummary() {
            const sequenceSummaryValue = document.getElementById('id_sequence_summary').value;
            const haartClassField = document.getElementById('id_haart_class');
            const resistanceLevelField = document.getElementById('id_resistance_level');

            if (sequenceSummaryValue === 'FAILED') {
                haartClassField.disabled = true;
                resistanceLevelField.disabled = true;
            } else {
                haartClassField.disabled = false;
                resistanceLevelField.disabled = false;
            }
        }

        // Call the function initially to set the initial state
        toggleFieldsBasedOnSequenceSummary();

        // Bind the function to the change event of sequence_summary field
        document.getElementById('id_sequence_summary').addEventListener('change', function() {
            toggleFieldsBasedOnSequenceSummary();
        });
    });
</script>


<script>
    // Initialize CKEditor on the textarea with id "id_abstract"
    CKEDITOR.replace('id_abstract');
</script>

<script>
    $(window).on('load', function() {
    updateFormFields();
});
  $(document).ready(function () {

    // Function to enable or disable fields based on author selection, status, and acceptance status
    function updateFormFields() {
        // List of fields to disable or enable for author selection
        var authorFieldsToDisable = ["#id_data_submitted", "#id_acceptance_status", "#id_publication_date",
            "#id_journal", "#id_citations", "#id_data_started", "#id_status", "#id_categories", "#id_title",
            {#"#id_abstract",#}
            {#"#cke_id_abstract",#}
            "#id_keywords","#id_submission_type","#id_conference","#id_venue"];

        // Check if any author checkbox is checked
        var anyAuthorSelected = $('input[name="authors"]:checked').length > 0;

        var statusAndDatesFieldsToDisable = ["#id_data_submitted",
        ];

        var selectedStatus = $("#id_status").val();
        var publicationDate = $("#id_publication_date"); // Fix: use the jQuery object
        var acceptanceStatus = $("#id_acceptance_status").val();
        var submittedDate = $("#id_data_submitted").val();
        var submissionType = $("#id_submission_type").val();

        // Enable or disable fields based on author selection
        $(authorFieldsToDisable.join(", ")).prop("disabled", !anyAuthorSelected);

        // Enable all fields first
        $(statusAndDatesFieldsToDisable.join(", ")).prop("disabled", false);

        // Disable specific fields based on the selected status
        if (selectedStatus === "draft" || !anyAuthorSelected) {
            $(statusAndDatesFieldsToDisable.join(", ")).prop("disabled", true);
         }

        // Disable citations if there is no publication date
        if (!publicationDate.val()) {
            $("#id_citations").prop("disabled", true);
        }

        // Disable acceptance status, publication date, and journal if there is no submitted date
        if (!submittedDate) {
            $("#id_submission_type").prop("disabled", true);
        }

        if (submissionType === "journal" || !anyAuthorSelected) {
            $("#id_conference").prop("disabled", true);
            $("#id_venue").prop("disabled", true);
            // Optionally, clear the value in the conference field
            $("#id_conference").val('');
            $("#id_venue").val('');
        } else if (submissionType === "conference" || !anyAuthorSelected) {
            $("#id_journal").prop("disabled", true);
            // Optionally, clear the value in the journal field
            $("#id_journal").val('').trigger('change');
        } else {
            // Enable both fields if submissionType is not selected and clear values
            $("#id_conference, #id_journal,#id_venue").prop("disabled", true).val('');
            $("#id_journal").val('').trigger('change');
            $("#id_conference").val('');
        }

        // Enable or disable publication date based on acceptance status
        publicationDate.prop("disabled", acceptanceStatus !== "yes");
    }

    // Initial update based on author selection, status, and acceptance status
    updateFormFields();

    // Update fields whenever author selection, status, acceptance status, publication date, or submitted date changes
    $('input[name="authors"], #id_status, #id_acceptance_status, #id_publication_date, #id_data_submitted,#id_submission_type,#id_conference').change(function () {
        updateFormFields();
    });
});

</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Retrieve the stored authors from local storage
    var storedAuthors = localStorage.getItem("selectedAuthors");
    var selectedAuthors = storedAuthors ? JSON.parse(storedAuthors) : [];

    // Check if the form is for updating
    var isUpdating = document.getElementById("myForm_update") !== null;
    // Check if the form has ID "form_filter"
    var isFilterForm = document.getElementById("form_filter") !== null;

    if (!isUpdating && !isFilterForm ) {
      // Query the checkboxes once and store the result for reuse
      var authorCheckboxes = document.querySelectorAll('input[name="authors"]');

      // Loop through the checkboxes and set the 'checked' attribute based on the stored data
      authorCheckboxes.forEach(function(checkbox) {
        var authorId = checkbox.value;
        checkbox.checked = selectedAuthors.includes(authorId);
      });

      // Add event listener for change event on checkboxes
      authorCheckboxes.forEach(function(checkbox) {
        checkbox.addEventListener("change", function() {
          // Update the selectedAuthors array based on the checkbox state
          var authorId = checkbox.value;
          if (checkbox.checked) {
            selectedAuthors.push(authorId);
          } else {
            selectedAuthors = selectedAuthors.filter(function(id) {
              return id !== authorId;
            });
          }

          // Save the updated selectedAuthors array to local storage
          localStorage.setItem("selectedAuthors", JSON.stringify(selectedAuthors));
        });
      });
    } // end if not update form or filtering form
  });
</script>

<script>
    $(document).ready(function () {
        // Function to save form data in localStorage
        function saveFormData() {
            var formData = {
                title: $("#id_title").val(),
                authors: $("#id_authors").val(),
                publication_date: $("#id_publication_date").val(),
                keywords: $("#id_keywords").val(),
                pdf_file: $("#id_pdf_file").val(),
                status: $("#id_status").val(),
                acceptance_status: $("#id_acceptance_status").val(),
                citations: $("#id_citations").val(),
                data_started: $("#id_data_started").val(),
                data_submitted: $("#id_data_submitted").val(),
                {#abstract: $("#id_abstract").val(),#}
                abstract: CKEDITOR.instances.id_abstract.getData()
            };

            // Convert the formData object to JSON and store it in localStorage
            localStorage.setItem("formData", JSON.stringify(formData));
        }

        // Function to load form data from localStorage
        function loadFormData() {
            // Get the stored formData from localStorage
            var storedData = localStorage.getItem("formData");

            // If storedData exists, parse it from JSON and populate the form fields
            if (storedData) {
                var formData = JSON.parse(storedData);
                $("#id_title").val(formData.title);
                $("#id_authors").val(formData.authors);
                $("#id_publication_date").val(formData.publication_date);
                $("#id_keywords").val(formData.keywords);
                $("#id_pdf_file").val(formData.pdf_file);
                $("#id_status").val(formData.status);
                $("#id_acceptance_status").val(formData.acceptance_status);
                $("#id_citations").val(formData.citations);
                $("#id_data_started").val(formData.data_started);
                $("#id_data_submitted").val(formData.data_submitted);
                $("#id_abstract").val(formData.abstract);
            }
        }
        // Check if the form is for updating
        var isUpdateForm = document.getElementById("myForm_update") !== null;

        if (!isUpdateForm) {
            // Initial loading of form data
            loadFormData();

            // Save form data whenever there's a change in form fields
            $("form :input").on("change", function () {
                saveFormData();
            });

            // Initialize Select2 for both fields
            $('#id_journal, #id_categories').select2();

            // Retrieve the values from local storage on page load for each field
            var selectedJournal = localStorage.getItem('selectedJournal');
            if (selectedJournal) {
                $('#id_journal').val(selectedJournal).trigger('change');
            }

            var selectedCategory = localStorage.getItem('selectedCategory');
            if (selectedCategory) {
                $('#id_categories').val(selectedCategory).trigger('change');
            }

            // Add event listener for change event for the journal field
            $('#id_journal').on('change', function () {
                var selectedValue = $(this).val();
                localStorage.setItem('selectedJournal', selectedValue);
            });

            // Add event listener for change event for the categories field
            $('#id_categories').on('change', function () {
                var selectedValue = $(this).val();
                localStorage.setItem('selectedCategory', selectedValue);
            });
              }
            // Function to check if a redirection occurred
            function checkRedirection() {
            var currentUrl = window.location.href;
            var previousUrl = localStorage.getItem("previousUrl");

            if (previousUrl && previousUrl !== currentUrl) {
                // Clear localStorage if a redirection occurred
                localStorage.clear();
            }

            // Update the previousUrl in localStorage
            localStorage.setItem("previousUrl", currentUrl);
        }
    });
</script>


<script>
    function resetForm() {
        // Ask the user for confirmation
        var confirmReset = confirm("Are you sure you want to reset the form? Any unsaved changes will be lost.");

        if (confirmReset) {
            // Remove specific items from local storage
            localStorage.removeItem("formData");
            localStorage.removeItem("selectedJournal");
            localStorage.removeItem("selectedCategory");
            localStorage.removeItem("selectedAuthors");

            // Optionally, you can reset the form fields to their initial state
            document.getElementById("myForm").reset();

            // Reload the form
            location.reload();
        }
    }
</script>


<script>
document.addEventListener('DOMContentLoaded', function () {
    var statusField = document.querySelector('#id_status');
    var journalField = document.querySelector('#id_journal');
    var submitButton = document.querySelector('#submit-button');
    var journalError = document.querySelector('#journal-error');

    // Function to toggle the 'required' attribute of the journal field based on the status field value
    function toggleJournalRequired() {
        if (statusField.value !== 'draft') {
            journalField.required = true;
        } else {
            journalField.required = false;
            journalError.style.display = 'none';  // Hide error message if not required
        }
    }

    // Initial call to set 'required' attribute based on initial status field value
    toggleJournalRequired();

    // Event listener to toggle 'required' attribute when status field value changes
    statusField.addEventListener('change', toggleJournalRequired);

    // Event listener to check validation on form submission
    submitButton.addEventListener('click', function (event) {
        if (journalField.required && !journalField.value.trim()) {
            journalError.style.display = 'block';
            event.preventDefault();  // Prevent form submission
        }
    });
});
</script>



{% block footer %}{% endblock %}
</body>
</html>